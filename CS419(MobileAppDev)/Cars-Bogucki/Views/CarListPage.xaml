<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Cars_Bogucki.ViewModels"
             x:Class="Cars_Bogucki.Views.CarListPage"
             Title="Cars">
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Add" Priority="0" Order="Primary" Clicked="OnAddClicked" />
    </ContentPage.ToolbarItems>
    <Grid RowDefinitions="Auto,*">
        <ActivityIndicator IsRunning="{Binding IsBusy}" 
                          IsVisible="{Binding IsBusy}" 
                          Margin="10"/>
        <CollectionView Grid.Row="1" 
                       ItemsSource="{Binding Cars}" 
                       SelectionMode="Single" 
                       SelectionChanged="OnSelectionChanged">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid Padding="12" ColumnDefinitions="Auto,*,Auto">
                        <Border WidthRequest="56" 
                               HeightRequest="56" 
                               StrokeThickness="0"
                               BackgroundColor="#EFEFEF" 
                               VerticalOptions="Center">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            <Grid>
                                <!-- Show image if URL exists -->
                                <Image Source="{Binding ImageUrl}" 
                                       Aspect="AspectFill"
                                       IsVisible="{Binding ImageUrl, Converter={StaticResource StringNotEmptyConverter}}"/>
                                <!-- Show make letter if no image URL -->
                                <Label Text="{Binding Make, StringFormat='{}{0:0}'}" 
                                      HorizontalOptions="Center" 
                                      VerticalOptions="Center"
                                      IsVisible="{Binding ImageUrl, Converter={StaticResource StringEmptyConverter}}"/>
                            </Grid>
                        </Border>
                        <VerticalStackLayout Grid.Column="1" Spacing="2" Margin="12,0,0,0">
                            <Label Text="{Binding DisplayName}" FontAttributes="Bold"/>
                            <Label Text="{Binding Price, StringFormat='${0:N0}'}" 
                                  FontSize="12" 
                                  TextColor="Gray"/>
                        </VerticalStackLayout>
                        <Label Grid.Column="2" 
                              Text="â€º" 
                              FontSize="24" 
                              VerticalOptions="Center"/>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>